<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Hacker Beach Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

    <link rel="stylesheet" type="text/css" href="leaflet.css" />
    <!-- <link rel="stylesheet" type="text/css" href="leaflet.label.css" /> -->

    <script src="leaflet-src.js" type="text/javascript"></script>
    <!-- <script src="leaflet.label.js" type="text/javascript"></script> -->
    <script src="jquery.min.js" type="text/javascript"></script>
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <link rel="stylesheet" type="text/css" href="css/leaflet.ie.css" />
    <![endif]-->
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      header {
        position: absolute;
        top: 10px;
        left: 50px;
        right: 10px;
        background: rgba(0,0,0,0.25);
        z-index: 100000;
        -moz-border-radius: 7px;
        -webkit-border-radius: 7px;
        border-radius: 7px;
        padding: 0 10px;
      }
      h1 {
        display: inline;
        float: left;
        font: 14px sans-serif;
        font-weight: bold;
        line-height: 26px;
        color: #fff;
      }
      nav {
        display: inline;
        float: right;
      }
      nav ul {
        list-style: none;
        display: inline;
      }
      nav ul li {
        display: inline-block;
        font: 14px sans-serif;
      }
      nav ul li a {
        color: #fff;
        line-height: 26px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <header>
      <h1>Hacker Beach Map</h1>
      <nav>
        <ul>
          <li><a href="https://github.com/skddc/hackerbeach-map">Fork and contribute!</a></li>
        </ul>
      </nav>
    </header>

    <script type="text/javascript">

      // Set up full-screen map container
      function resize() {
        $('#map').css('width', window.innerWidth)
        $('#map').css('height', window.innerHeight)
      }
      resize();
      window.onresize = resize;

      // Initialize map
      var map = L.map('map').setView([10.19421590238582, 103.96751343265065], 13);

      // Add map tile layer from CloudMade
      L.tileLayer('http://{s}.tile.cloudmade.com/bcd9fb3d7b67440190a9139c46301a75/997/256/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>, Marker icons &copy; <a href="http://mapicons.nicolasmollet.com/">Maps Icons Collection</a>, <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>',
        maxZoom: 18
      }).addTo(map);

      // Load places GeoJSON
      $.getJSON('places.json', function(data){
        renderPlaces(data);
      });

      // Create places layer with markers
      var renderPlaces = function (places) {
        $.each(places, function(index, place){
          L.geoJson(place, {
            onEachFeature: onEachFeature
          }).addTo(map);
        });
      }


      // Custom map icon class
      var LeafIcon = L.Icon.extend({
        options: {
          iconSize:     [32, 37],
          iconAnchor:   [16, 35],
          /* shadowUrl: 'marker-shadow.png', */
          /* shadowSize:   [50, 64], */
          /* shadowAnchor: [4, 62], */
          popupAnchor:  [0, -30]
        }
      });

      // Add data and options on GeoJSON parsing
      var onEachFeature  = function (feature, layer) {
        if (feature.properties && feature.properties.popupContent) {
          var popupContent = '<h2>'+feature.properties.name+'</h2>';
          popupContent += '<p>'+feature.properties.popupContent+'</p>';
          var icon = new LeafIcon({
            iconUrl: '/images/markers/'+feature.properties.icon+'.png'
          });

          layer.bindPopup(popupContent);
          layer.setIcon(icon);
          /* layer.bindLabel(feature.properties.name); */
        }
      }

    </script>
  </body>
</html>
